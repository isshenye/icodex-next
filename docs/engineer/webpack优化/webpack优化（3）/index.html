<!doctype html>
<html class="docs-version-current" lang="zh-CN" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="icodex RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="icodex Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-153188913-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-153188913-1",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="icodex" href="/opensearch.xml">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">webpack优化（3） | icodex</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://icodex.me/docs/engineer/webpack优化/webpack优化（3）"><meta data-react-helmet="true" name="docsearch:language" content="zh-CN"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" name="keywords" content="frontend, react, javascript, css, react, vue, typescript, docusaurus, blog, personal blog, personal website"><meta data-react-helmet="true" property="og:title" content="webpack优化（3） | icodex"><meta data-react-helmet="true" name="description" content="webpack 文档提供了一些优化构建性能的建议 —— webpack - 构建性能，对于一些小型项目来说，这些建议很有用！"><meta data-react-helmet="true" property="og:description" content="webpack 文档提供了一些优化构建性能的建议 —— webpack - 构建性能，对于一些小型项目来说，这些建议很有用！"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://icodex.me/docs/engineer/webpack优化/webpack优化（3）"><link data-react-helmet="true" rel="alternate" href="https://icodex.me/docs/engineer/webpack优化/webpack优化（3）" hreflang="zh-CN"><link data-react-helmet="true" rel="alternate" href="https://icodex.me/docs/engineer/webpack优化/webpack优化（3）" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://GMKEEJO8X4-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.83facce5.css">
<link rel="preload" href="/assets/js/runtime~main.bc1968d0.js" as="script">
<link rel="preload" href="/assets/js/main.84a75bf0.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_RReh"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="icodex" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo.png" alt="icodex" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">icodex</b></a></div><div class="navbar__items navbar__items--right"><div class="searchBox_Utm0"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><a class="navbar__item navbar__link" href="/pages/project">My Project</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">Skill</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/javascript/类型/类型定义">JavaScript</a></li><li><a class="dropdown__link" href="/docs/css/CSS代码规范">CSS</a></li><li><a class="dropdown__link" href="/docs/typescript/tsconfig">TypeScript</a></li><li><a class="dropdown__link" href="/docs/react/hooks/常用hooks">React</a></li><li><a class="dropdown__link" href="/docs/nodejs/awesome-nodejs">NodeJS</a></li><li><a class="dropdown__link navbar__link--active" href="/docs/engineer/">Engineer</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">Learn</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/network/网速与带宽">Network</a></li><li><a class="dropdown__link" href="/docs/algorithm/算法分析">Algorithm</a></li></ul></div><a class="navbar__item navbar__link" href="/docs/tools/git">Tool</a><a href="https://github.com/wood3n/icodex-next" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌜</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">🌞</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0 sidebarWithHideableNavbar_VlPv"><a tabindex="-1" class="sidebarLogo_hmkv" href="/"><img src="/img/logo.png" alt="icodex" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo.png" alt="icodex" class="themedImage_TMUO themedImage--dark_uzRr"><b>icodex</b></a><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/engineer/ESLint">ESLint的使用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/engineer/git hooks">git hook构建代码规范</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/engineer/">前端工程化体系工具</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/engineer/跨域解决方式">跨域与解决方案</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/engineer/Babel/babel plugin编写">Babel</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/webpack5">webpack5配置</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/docs/engineer/webpack优化/webpack优化（1）">webpack优化</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/webpack优化/webpack优化（1）">webpack优化（1）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/webpack优化/webpack优化（2）">webpack优化（2）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/engineer/webpack优化/webpack优化（3）">webpack优化（3）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/webpack优化/webpack优化（4）">webpack优化（4）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/webpack优化/webpack打包分析工具">webpack打包分析工具</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/webpack优化/根据入口拆分chunk">webpack分入口打包</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/webpackinner">webpack原理</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/engineer/使用yeoman搭建脚手架/脚手架搭建（1）">使用yeoman搭建脚手架</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/engineer/基于webpack搭建react项目/搭建React项目（1）">基于webpack搭建react项目</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/engineer/模块语法/CSS模块语法">模块语法</a></div></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>webpack优化（3）</h1></header><p>webpack 文档提供了一些优化构建性能的建议 —— <a href="https://webpack.docschina.org/guides/build-performance/" target="_blank" rel="noopener noreferrer">webpack - 构建性能</a>，对于一些小型项目来说，这些建议很有用！</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="优化模块解析规则">优化模块解析规则<a class="hash-link" href="#优化模块解析规则" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="ruleinclude-和-ruleexclude">rule.include 和 rule.exclude<a class="hash-link" href="#ruleinclude-和-ruleexclude" title="Direct link to heading">​</a></h3><p>在使用 loader 的时候通过<code>include</code>或者<code>exclude</code>属性传入必要的路径和文件，避免全局匹配，可以提升 webpack 构建的速度。</p><p>例如<code>babel-loader</code>忽略<code>node_modules</code>内部的模块</p><div class="codeBlockContainer_J+bg language-javascript theme-code-block"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  module</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    rules</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        test</span><span class="token operator">:</span><span class="token plain"> </span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">\.m?jsx?$</span><span class="token regex regex-delimiter">/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        exclude</span><span class="token operator">:</span><span class="token plain"> </span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">(node_modules)</span><span class="token regex regex-delimiter">/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">//剔除node_modules</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        loader</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;babel-loader&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        options</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          presets</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;@babel/preset-env&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                modules</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;@babel/preset-react&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          plugins</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;@babel/plugin-proposal-class-properties&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            isDevelopment </span><span class="token operator">&amp;&amp;</span><span class="token plain"> require</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">resolve</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;react-refresh/babel&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">filter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token known-class-name class-name">Boolean</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>在匹配图片文件的时候，指定具体的文件夹：</p><div class="codeBlockContainer_J+bg language-javascript theme-code-block"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  module</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    rules</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        test</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">\.bmp$</span><span class="token regex regex-delimiter">/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">\.gif$</span><span class="token regex regex-delimiter">/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">\.jpe?g$</span><span class="token regex regex-delimiter">/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">\.png$</span><span class="token regex regex-delimiter">/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">\.svg$</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-flags">i</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        include</span><span class="token operator">:</span><span class="token plain"> path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">resolve</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">__dirname</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;src/assets/images&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">//仅包含图片文件夹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        use</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            loader</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;url-loader&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            options</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              limit</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">1024</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;static/images/[name].[contenthash:8].[ext]&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            loader</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;image-webpack-loader&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            options</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              disable</span><span class="token operator">:</span><span class="token plain"> isDevelopment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="resolvemodules">resolve.modules<a class="hash-link" href="#resolvemodules" title="Direct link to heading">​</a></h3><p><code>resolve.modules</code>指定 webpack 解析模块时应该搜索的目录，默认是<code>[&#x27;node_modules&#x27;]</code>，也就是 webpack 会首先查找项目根目录的<code>node_modules</code>文件夹去寻找模块，如果找不到就往上一级目录 <code>../node_modules</code> 中去找，实际上这种查找是不需要的，毕竟项目一般也不会使用层层嵌套的结构。</p><p>可以通过<code>path.resolve</code>来构造绝对路径值，这样就只会在给定目录中查找模块了。并且，有时候这个配置比<code>alias</code>还简洁，比方说对于项目中封装通用业务组件库位于<code>src/components</code>下面，然后通过<code>resolve.modules</code>配置模块解析规则如下</p><div class="codeBlockContainer_J+bg language-javascript theme-code-block"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  resolve</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    modules</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">resolve</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">__dirname</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;./src/components&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">resolve</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">__dirname</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;./src&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">resolve</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">__dirname</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;node_modules&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>这时候在编写页面的时候，如果<code>import</code>一个<code>src/components</code>下里面的组件，就不用带任何路径前缀直接写文件夹就行了，nice！不过这时候的弊端就是如果你的组件和第三方库的组件同名，就会把第三方库的组件覆盖掉了。</p><div class="codeBlockContainer_J+bg language-javascript theme-code-block"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Button</span><span class="token imports"> </span><span class="token imports punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Button/index.jsx&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>这个配置加上上文提到的<code>rule.resolve.extensions</code>，结合在一起就是神器，对于<code>src/components</code>的组件，例如<code>src/components/Button</code>，直接一句话就搞定，webpack 会自动查找<code>src/components/Button</code>文件夹下的<code>index</code>文件。</p><div class="codeBlockContainer_J+bg language-javascript theme-code-block"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Button</span><span class="token imports"> </span><span class="token imports punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Button&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="resolvesymlinks">resolve.symlinks<a class="hash-link" href="#resolvesymlinks" title="Direct link to heading">​</a></h3><p>在开发若干个有相互依赖关系的库的时候，通常都会采用 symlink 的方式互相引用。对于单个项目来说，直接将<code>resolve.symlinks</code>禁用比较好。</p><div class="codeBlockContainer_J+bg language-javascript theme-code-block"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  resolve</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    symlinks</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="modulenoparse">module.noParse<a class="hash-link" href="#modulenoparse" title="Direct link to heading">​</a></h3><p><code>module.noParse</code>指定一个字符串或者正则表达式，对于匹配的模块名，webpack 不会去解析它们。这在忽略一些大型库时，可以提高构建性能。</p><div class="codeBlockContainer_J+bg language-javascript theme-code-block"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  module</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    noParse</span><span class="token operator">:</span><span class="token plain"> </span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">jquery|lodash</span><span class="token regex regex-delimiter">/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="利用缓存">利用缓存<a class="hash-link" href="#利用缓存" title="Direct link to heading">​</a></h2><p>合理利用缓存可以加快 webpack 二次构建的速度，尽管在首次使用这些 loader 或者 plugin 的时候耗时可能会很长，但是后续执行可能会带来飞速提升。</p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="优化-babel-loader">优化 babel-loader<a class="hash-link" href="#优化-babel-loader" title="Direct link to heading">​</a></h3><p><code>babel-loader</code>是最主要的 loader，它需要处理大量的 JS，JSX 等涉及 JS 的模块，可以通过其内置的缓存配置来缓存其执行结果。</p><p><code>babel-loader</code>支持以下有关缓存的配置项：</p><ul><li><code>cacheDirectory</code>：默认是<code>false</code>，当设置成<code>true</code>以后，<code>babel-loader</code>会使用默认的缓存目录 <code>node_modules/.cache/babel-loader</code>缓存 loader 的执行结果，在以后的 webpack 打包的时候，将会尝试读取缓存，来避免每次都重新编译</li><li><code>cacheIdentifier</code>：用来指定缓存的标识符，默认是由 <code>@babel/core</code> 版本号，<code>babel-loader</code> 版本号，<code>.babelrc</code> 文件内容（存在的情况下），环境变量 <code>BABEL_ENV</code> 的值（没有时降级到 <code>NODE_ENV</code>）组成的一个字符串，通过改变<code>cacheIdentifier</code>来使缓存失效</li><li><code>cacheCompression</code>：默认是<code>true</code>，会使用 Gzip 压缩每个 Babel 编译的结果</li></ul><div class="codeBlockContainer_J+bg language-javascript theme-code-block"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  module</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    rules</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        test</span><span class="token operator">:</span><span class="token plain"> </span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">\.m?jsx?$</span><span class="token regex regex-delimiter">/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        loader</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;babel-loader&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        options</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token comment" style="color:rgb(98, 114, 164)">//...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          cacheDirectory</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="优化-eslint-loader">优化 eslint-loader<a class="hash-link" href="#优化-eslint-loader" title="Direct link to heading">​</a></h3><p>如果项目在使用<code>eslint-loader</code>，一定要使用<code>exclude</code>忽略<code>node_modules</code>文件夹，并开启<code>cache:true</code>缓存项，因为<code>eslint-loader</code>检查代码真的超级耗时间！</p><p>过去的项目使用经验，大概是 10 分钟的打包时间，<code>eslint-loader</code>在不开启缓存的时候，占用了 <strong>1/5</strong> 的打包时间！</p><p><img alt="image-20200912230721400" src="/assets/images/image-20200912230721400-0460d5075667338d31c67adb43eb04f6.png"></p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="cache-loader">cache-loader<a class="hash-link" href="#cache-loader" title="Direct link to heading">​</a></h3><p><a href="https://github.com/webpack-contrib/cache-loader" target="_blank" rel="noopener noreferrer"><code>cache-loader</code></a>是一个 webpack loader，可以缓存 loader 的执行结果到本地磁盘文件夹中或者放在一个数据库中。但是本身来说，缓存到本地文件夹中涉及到 IO 操作，在 webpack 执行打包的过程中会带来更大的内存占用问题，所以，只在需要编译大量模块的 loader 中使用<code>cache-loader</code>。</p><ul><li><code>babel-loader</code>：需要编译大量 JS 代码，但是上文说了，它默认带有缓存选项</li><li><code>css-loader</code>：可能会需要；其他类似的处理 CSS 预处理器的 loader 也可以使用</li><li><code>image-webpack-loader</code>：压缩图片的 loader，这个耗时比较多，可以考虑缓存其执行结果</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="配置项">配置项<a class="hash-link" href="#配置项" title="Direct link to heading">​</a></h4><p><code>cache-loader</code>虽然已经接近一年没有更新过了，但是它是 webpack 团队维护的，所以还是值得信赖的。</p><table><thead><tr><th>配置项</th><th>类型</th><th>默认值</th><th>含义</th></tr></thead><tbody><tr><td><strong><code>cacheContext</code></strong></td><td><code>{String}</code></td><td><code>undefined</code></td><td>相对于设置的路径生成缓存</td></tr><tr><td><strong><code>cacheKey</code></strong></td><td><code>{Function(options, request) -&gt; {String}}</code></td><td><code>undefined</code></td><td>重写生成缓存项的键的函数</td></tr><tr><td><strong><code>cacheDirectory</code></strong></td><td><code>{String}</code></td><td><code>findCacheDir({ name: &#x27;cache-loader&#x27; }) or os.tmpdir()</code></td><td>设置缓存写入和读取的目录</td></tr><tr><td><strong><code>cacheIdentifier</code></strong></td><td><code>{String}</code></td><td><code>cache-loader:{version} {process.env.NODE_ENV}</code></td><td>设置一个用于生成 hash 的标识符</td></tr><tr><td><strong><code>compare</code></strong></td><td><code>{Function(stats, dep) -&gt; {Boolean}}</code></td><td><code>undefined</code></td><td>修改缓存比较的函数，如果返回<code>true</code>就表示使用缓存而不是去执行 loader 生成新资源</td></tr><tr><td><strong><code>precision</code></strong></td><td><code>{Number}</code></td><td><code>0</code></td><td>Round <code>mtime</code> by this number of milliseconds both for <code>stats</code> and <code>dep</code> before passing those params to the comparing function</td></tr><tr><td><strong><code>read</code></strong></td><td><code>{Function(cacheKey, callback) -&gt; {void}}</code></td><td><code>undefined</code></td><td>使用函数生成一个新的内容来覆盖缓存的内容</td></tr><tr><td><strong><code>readOnly</code></strong></td><td><code>{Boolean}</code></td><td><code>false</code></td><td>如果不希望更新缓存，只是读取它可以将这个配置项设为<code>true</code></td></tr><tr><td><strong><code>write</code></strong></td><td><code>{Function(cacheKey, data, callback) -&gt; {void}}</code></td><td><code>undefined</code></td><td>使用函数生成新资源来替换缓存内容</td></tr></tbody></table><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="使用">使用<a class="hash-link" href="#使用" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">yarn</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">add</span><span class="token plain"> cache-loader -D</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>使用的时候在耗时长的 loader 前面添加<code>cache-loader</code>就可以了，至于如何分析 loader 的执行时间，可以借助<code>speed-measure-webpack-plugin</code>这个工具。</p><p>下面是我在<code>image-webpack-loader</code>这个负责压缩图片的 loader 前添加的配置，<strong>一定要注意在<code>image-webpack-loader</code>前引入<code>cache-loader</code></strong>，我现在还不明白<code>cache-loader</code>到底什么原理，我测试是在<code>url-loader</code>前使用<code>cache-loader</code>打包会丢失图片。</p><div class="codeBlockContainer_J+bg language-javascript theme-code-block"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  module</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    rules</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        test</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">\.bmp$</span><span class="token regex regex-delimiter">/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">\.gif$</span><span class="token regex regex-delimiter">/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">\.jpe?g$</span><span class="token regex regex-delimiter">/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">\.png$</span><span class="token regex regex-delimiter">/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">\.svg$</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-flags">i</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        include</span><span class="token operator">:</span><span class="token plain"> path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">resolve</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">__dirname</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;src/assets/images&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        use</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            loader</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;url-loader&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            options</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              limit</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">1024</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">//10KB</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;static/images/[name].[contenthash:8].[ext]&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;cache-loader&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">//引入cache-loader</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            loader</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;image-webpack-loader&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            options</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              disable</span><span class="token operator">:</span><span class="token plain"> isDevelopment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">//开发环境下禁用压缩图片</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>在引入<code>cache-loader</code>前，我的页面中包含一张<code>7MB</code>左右的图片需要压缩，打包的耗时是这样的：</p><p><img alt="image-20200912165834559" src="/assets/images/image-20200912165834559-a667e73541117d05359e4f68fe89ad4d.png"></p><p>使用<code>cache-loader</code>打包一次后，再次打包，明显缩短了<code>image-webpack-loader</code>的处理时长。</p><p><img alt="image-20200912165944112" src="/assets/images/image-20200912165944112-412d84e1aa65271629fe912a529b1662.png"></p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="多线程打包">多线程打包<a class="hash-link" href="#多线程打包" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="thread-loader">thread-loader<a class="hash-link" href="#thread-loader" title="Direct link to heading">​</a></h3><p><a href="https://github.com/webpack-contrib/thread-loader" target="_blank" rel="noopener noreferrer"><code>thread-loader</code></a>是 webpack 团队提供的一个 webpack loader，如果正在使用<a href="https://github.com/amireh/happypack" target="_blank" rel="noopener noreferrer">happypack</a>也建议迁移到<code>thread-loader</code>上来，happypack 已经不再维护了。</p><p><code>thread-loader</code>利用的是 nodejs 的 <a href="https://nodejs.org/zh-cn/docs/guides/dont-block-the-event-loop/" target="_blank" rel="noopener noreferrer">worker pool 机制</a>，或者叫 thread pool；当使用 node 启动 webpack 打包程序的时候，webpack 主程序会运行在事件循环的主线程上，还有 worker pool 负责处理高成本的任务。</p><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="配置项-1">配置项<a class="hash-link" href="#配置项-1" title="Direct link to heading">​</a></h4><table><thead><tr><th>配置项</th><th>类型</th><th>含义</th></tr></thead><tbody><tr><td><code>workers</code></td><td><code>Number</code></td><td>产生的 worker 的数量，默认是<code>cpu 核心数 - 1</code></td></tr><tr><td><code>workerParallelJobs</code></td><td><code>Number</code></td><td>一个 worker 进程中并行执行工作的数量；默认是<code>20</code></td></tr><tr><td><code>workerNodeArgs</code></td><td><code>Array</code></td><td>额外的 node.js 参数，例如<code>[&#x27;--max-old-space-size=1024&#x27;]</code></td></tr><tr><td><code>poolRespawn</code></td><td><code>Boolean</code></td><td>允许重新开启一个死掉的 work 池；重新开启会减慢整个编译速度，并且开发环境应该设置为<code>false</code></td></tr><tr><td><code>poolTimeout</code></td><td><code>Number</code></td><td>设置超过一定时间自动终止 worker，默认是<code>500ms</code>，可以设置为<code>Infinity</code>，这样会让 worker 一直处于活跃状态</td></tr><tr><td><code>poolParallelJobs</code></td><td><code>Number</code></td><td>池分配给 worker 的工作数量，默认是<code>200</code>，减少的话会降低效率但是会使分配更加合理</td></tr><tr><td><code>name</code></td><td><code>String</code></td><td>worker 池的名称，可用于创建具有其他相同选项的不同 worker pool</td></tr></tbody></table><p><code>max-old-space-size</code>这个额外的 nodejs 参数，在 nodejs 文档中介绍的有，这个 CLI 参数是配置 V8 引擎在执行 JS 时候最大可以使用的系统内存的，单位是<code>MB</code>，默认值是<code>512MB</code>。在 nodejs 执行的时候，如果内存限制太小，V8 就不得不频繁执行 GC 来释放哪些用不到的变量占用的内存，当程序需要的内存太大时，有时候 V8 会直接终止程序执行。stack overflow 上有一个相关问题 —— <a href="https://stackoverflow.com/questions/48387040/node-js-recommended-max-old-space-size/48392705#48392705" target="_blank" rel="noopener noreferrer">Node.js recommended “max-old-space-size”</a>。</p><p>webpack 打包程序也是一样，对于超出内存限制，打包程序会被终止。</p><p><img alt="image-20200912190631480" src="/assets/images/image-20200912190631480-b46c7562c53d429ab5bf6dca7602d3fc.png"></p><p>解决这种问题的方法就是通过在<code>package.json</code>的 npm- script 中指定 CLI 参数，例如：</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;scripts&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;build&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;node --max-old-space-size=8192 scripts/build.js&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain">,</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="使用-1">使用<a class="hash-link" href="#使用-1" title="Direct link to heading">​</a></h4><p>在其它 loader 的配置前面添加<code>thread-loader</code>，则它们将会在一个 worker pool 中运行。每个 worker 都是一个独立的 node.js 进程，开启 worker 本身会产生额外开销的，每一个 worker 都会产生大于<code>600ms</code>的延迟。</p><p>此外对使用线程池执行的 loader 也会有限制：</p><ul><li>loader 不能产生新的文件</li><li>loader 不能使用自定义的 loader API</li><li>loader 不能获取 webpack 的配置</li></ul><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">yarn</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">add</span><span class="token plain"> thread-loader -D</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg language-javascript theme-code-block"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  module</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    rules</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        test</span><span class="token operator">:</span><span class="token plain"> </span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">\.js$</span><span class="token regex regex-delimiter">/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        include</span><span class="token operator">:</span><span class="token plain"> path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">resolve</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;src&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        use</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;thread-loader&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;babel-loader&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">//在babel-loader前使用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>为了避免开启 worker 前耗时过长，可以预热 worker pool，例如对于要使用的 loader，提前将其加载到 node.js 模块高速缓存中。</p><div class="codeBlockContainer_J+bg language-javascript theme-code-block"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> threadLoader </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">require</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;thread-loader&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">threadLoader</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">warmup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// worker的配置项，可以是传递给loader的配置项</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// loader</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;babel-loader&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;sass-loader&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>经过我在<code>babel-loader</code>和<code>eslint-loader</code>前添加<code>thread-loader</code>并开启线程预热以后，确实让相关 loader 的执行时间减少了大概 10 几秒的样子，总体来说影响不是很明显。</p><p><img alt="image-20200913003400905" src="/assets/images/image-20200913003400905-12e8c9059df108d441a8845ed121729c.png"><img alt="image-20200913003347937" src="/assets/images/image-20200913003347937-13668fc1a21f0772f2a854a1b9ab6c08.png"></p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="dll">DLL<a class="hash-link" href="#dll" title="Direct link to heading">​</a></h2><p>DLL（Dynamic-link library，动态链接库）这个词来源于微软的打包技术。其实 DLL 有点类似于按需加载的意味，把一些共享的代码抽成 DLL，当可执行文件调用到 DLL 中的函数时，操作系统才会把 DLL 文件加载到内存中。</p><p>不过，JS 不存在 DLL 这种东西，使用<code>DllPlugin</code> 只是让一些第三方库提前打包出来形成一个<a href="https://webpack.docschina.org/guides/author-libraries/" target="_blank" rel="noopener noreferrer"><code>library</code></a>，因为在一个项目中，往往它们基本上是不会频繁升级的，提前打包出来这样让 webpack 更多的去做项目代码打包的事情，极大的加快构建速度。有点类似于代码拆分的意味，但是 code splitting 还是会在 webpack 每次构建的时候都去打包，无法加快 webpack 的构建速度。</p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="library">library<a class="hash-link" href="#library" title="Direct link to heading">​</a></h3><p><code>library</code>也就是 JS 库，比如<code>lodash</code>等都属于一个 JS 库，webpack 提供了专门用于打包 JS 库的处理。其实 DLL 就是利用打包 library 的方式将项目代码抽成一个 library，并通过<a href="https://webpack.docschina.org/guides/author-libraries/#expose-the-library" target="_blank" rel="noopener noreferrer">暴露 library</a> 的形式让项目中其它模块可以使用到这些 library。</p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="dllplugin">DllPlugin<a class="hash-link" href="#dllplugin" title="Direct link to heading">​</a></h3><p><code>DllPlugin</code>是 webpack 内置的负责将代码抽出来单独打包的 webpack plugin。要使用<code>DllPlugin</code>，需要新建一个新的 webpack 配置文件，专门用于处理第三方库的打包。</p><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="配置项-2">配置项<a class="hash-link" href="#配置项-2" title="Direct link to heading">​</a></h4><table><thead><tr><th>配置项</th><th>类型</th><th>&lt;是否必填</th><th>含义</th></tr></thead><tbody><tr><td><code>context</code></td><td><code>String</code></td><td>no</td><td>manifest 文件中请求的 context；默认是 webpack 的<code>context</code>配置项，也就是<code>webpack.config.js</code>所在的当前目录</td></tr><tr><td><code>format</code></td><td><code>Boolean</code></td><td>no</td><td>是否格式化<code>manifest.json</code>；默认是<code>false</code></td></tr><tr><td><code>name</code></td><td><code>String</code></td><td>yes</td><td>暴露出的 DLL 的函数名</td></tr><tr><td><code>path</code></td><td><code>String</code></td><td>yes</td><td>输出的<code>manifest.json</code>的绝对路径</td></tr><tr><td><code>entryOnly</code></td><td><code>Boolean</code></td><td>no</td><td>默认是 <code>true</code>，仅暴露入口</td></tr><tr><td><code>type</code></td><td><code>String</code></td><td>no</td><td>生成的 DLL bundle 的类型</td></tr></tbody></table><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="使用-2">使用<a class="hash-link" href="#使用-2" title="Direct link to heading">​</a></h4><p>现在尝试配置<code>DllPlugin</code>把<code>react</code>的库文件从打包流程中抽取出来，在项目根目录新建一个<code>webpack.dll.config.js</code>的配置文件，使用<code>DllPlugin</code>。</p><div class="codeBlockContainer_J+bg language-javascript theme-code-block"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> path </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">require</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;path&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> webpack </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">require</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;webpack&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token maybe-class-name">CleanWebpackPlugin</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">require</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;clean-webpack-plugin&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">//清理build文件夹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  mode</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;production&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  entry</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    react</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;react&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;react-dom&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  output</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    path</span><span class="token operator">:</span><span class="token plain"> path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">resolve</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">__dirname</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;dll&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    filename</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;[name].[contenthash].dll.js&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    library</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;_[name]_dll&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  plugins</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">webpack</span><span class="token class-name punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token class-name">DllPlugin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      context</span><span class="token operator">:</span><span class="token plain"> __dirname</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      path</span><span class="token operator">:</span><span class="token plain"> path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">resolve</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">__dirname</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;dll/[name]-manifest.json&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;_[name]_dll&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>这里的配置有几点需要注意：</p><ul><li><code>entry</code>需要使用对象的配置形式，并且<strong>每个属性的值都必须是数组，即使内部只包含单个模块也必须放在数组里</strong></li><li><code>output.library</code>不要和原模块的名称一样，最好加个前缀或者后缀，例如<code>react</code>本身暴露的模块名是<code>react</code>，那么这里就不能再使用<code>react</code></li><li><code>output.library</code>就是上文提到的暴露 library 的形式，这样其他模块就可以使用<code>output.library</code>链接到抽取出来的 ”DLL“，<strong>这个属性值必须和<code>DllPlugin</code>内部的<code>name</code>配置项保持一致</strong></li></ul><p>最后结合 npm-scripts 在<code>package.json</code>中将执行这个单独的<code>webpack.dll.config.js</code>的命令写入进去。</p><div class="codeBlockContainer_J+bg language-json theme-code-block"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;dll&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;webpack --config webpack.dll.config.js&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>现在在控制台执行<code>yarn dll</code>，就会在项目根目录的<code>dll</code>文件夹中生成打包的 DLL 文件了，同时还会包含一些<code>manifest.json</code>文件，用于<code>DllReferencePlugin</code>。</p><p><img alt="image-20200913191529903" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAX4AAABFCAYAAABNEI0mAAASOUlEQVR4nO2de0xcV37HPwzz9PAwYCZTQ+zgUULIsm53W8TKqkNjyEpu4+7iBrlKpCqWsvxRWU0ko0r80Wr+av6oLSWVV7siq9hS1d26pHh33QZpA8mSbN0itukWoeBHydgOeCeDx4SX58Ew9I9778yd9zDGeMj8PpIl7j3v43t/53e+58w9ZQcOdG0gCIIglAyGR10BQRAEYXsRwy8IglBiiOEXBEEoMYzbWVhjUwMbG4lLCnM372xnFQRBEEqebTP87c+10f5cW8r96f+5yvuXPti6gno9OA/W4j1VDZ1eavoCrBxtYk3/99aVJgiCsOPYNsPf2NSQ9n7LN56m5RtPp9z/zX9O8tHwrx52tQRBEIoe0zNfUl4XAmDdb2Ht090PlF9eht9ofgLCN4lkjFGP1QzB8HzWfO567/LR8H9sroaCIAgljPWPvBhs67FrQ0UEoyNI4JfOgvPMY3H3eV74Cze97c9nGCXqeeqwm9Mvv8zjOXIKBcPMeuYA2NjYyPmv4Ym9VO2uzJHrIpXDIziHR3AOezDlbpAgCMKOwPTMlwlGX6PMto7pqaWC883D43+fn75joufVl+kFBsbf13n+itHvaZ5j8J03+TyPAqt2V3L85HfyruDQ+Z+x9OVyhtAwtosTcKkL7wAog8AEzNTmnb8gCEKxosk7acMeC7B2vaqgfPPbzhl9j8Ef/Qvzv/uyzvNXjH73gZsMvvN3XI/mV2BDBq0/E9oMIS29c1TTyuqAdqOa5UuuTeUvCIJQauS/uBt9j8EfQc+rL/OXZjsj5c/Tvf8mg//493kbfQBXS1PecT+76skdad7GJooXBEHYMaz7LRgq0q+urvstBee7uR9wqZ7/b1t66CnA6AM0PJG/xz/ryWOPf30goRGGvZlkIUEQhJ3F2qe7iQbKU+5HA+UPtLNn89s5o+8xOPBeQYXtce7BYjXnHX8um8wDMFDLavcE9l4ny6rGb2/3wcz+guonCIJQbAR/6UzczvmFrWBtX2Pb9vHPeuZoeGJv3vGXv1xm3ns3R6xqls+0UtM3grMbwIX/kgv7wQepqSAIQnGx9unuLf3hadl2fpY504+40jH/27uEgplXtAVBEITC2NZv9WTdoSMIgiBsC/J1TkEQhBJDDL8gCEKJIYZfEAShxBDDLwiCUGJsyvDX11sfVj0EQRCEbUI8fkEQhBJDDL8gCEKJIYZfEAShxBDDLwiCUGJs6y93czHzz7Obiu/688aHVBNBEISvLuLxPyIM7klq3OHY385ziyl/C4UQxnZxEltnPnHjx3ZW9qa7fgh0eqkZHsE5nG8d88lvi/ISSoai8vh3IqZzI1TcfZYFd/6fm948YWwXP6I65UusLvxHm1hTj5y0q3dD44n1MbgncbT7lIuZNrynqtWQ7OmSy42H50qXgU4vNX1TaMdHrF7qUj+nnRoGDhbPHCQwmiNdDhLaHusvLewWdl1/JF/nLjexH/Kpl6l7Csafxav1V0IZujZr9Hpwds+krT8Ao04WRgs/dFsofsy/dw/7dz9n9aePE/6NcqxsecN9ql69QWDsMYIFHLouhn9HYCZwoouA7o4y4DQoRqA3QORMF96YkbyKrVM1IL0eHC0OfEcPElUNeY1bNdTZ0qlxjaPaecY6sqbLjOEwrBztYgFUg+YhOKAzZEut+E44U05Uy5kuI4vY9+zHe1T5TrfBPYnjojehjNBdW0IK/XX2chepHL4V74dNELmjDZJhbL1TRC51sTCgltHrJTSq1q/Xg7PThu9ol5wyJ2wpX3HDr76c45VUt8/EPNOMHnBWDy/Z+/0WwZb/Uq5dH+EcTuON6dHnvdSKf/oBmtXppaK+lcVTqgEZcMYHhdFagr2+WFTTwRlWRzXDYSYw6qK68x4GnESzpKN3Duv0s4pBSiZbOjLPMKJunVEfqGW1+148kSuAZb42rYHLmi6pvNB4G8FYSDXLp3T5fOwg1B6gHCg/N0KdC8CHc9jF4swM1bpr/9Em1rKUa3DfgksZBru0z5Hu+XGNYO9sxXfChrHKRVDrY7WMclAG6U7wpxkIU8sKsKI+e6ZYuzYxExNKjqI3/OOfKq9P+zMhLgxXsLRq4OQfr1C5K18fyEf1nv14j6pn/SZ4wMqLonnAhsMBgme6WFA95biHp7y01mltir6Iza144ZG8pJ5FKvt88bw7vdT0+WD86YL6xNQ9RWQ0gxfYeQ8rDhZVr91Y7yAyowufsRHqDqjGJVM6ZcCI3LVRM6wZsAwDW1K6bP2bQO897DO1JByU6ZrAOaz8mVE2SU6XVJ7BPYmjCtKukrgCWGZqFQ/+VBc+9yTVPK3WrYlQwnW2csNYWiCCB+ew2rm62Uqm50h7XqyTWtvCRJZmsPY2sTaglrFkYzXWrzaCmzDkBvckdbThPVqdMY4gwA4y/NO3TPzrmJ2G+gjvT1g53nE/zxwcLF7SXoQwtk69Bwxrky4sBwOAmai7Ke7J6j28zntYaWUx9tJVE3Dn3wZFO94flwRGnSwe9lHQ69nppcLlYuWU/qbOm0yQSwIYqyDhqOZRG5G+QI50YYz1YK8nJjMY3JM4zi2q3nvmdNn6N0ETT1hrAAaa8A40xdpY0zeJbUbzqDOlSy0v6n6axYtX0/ZbTfcyi2ea8u3pLOUGMFb5VBlJyc90boRqdy0L7izPUQpmAieexXZRPUFO35euAJaqGSKjXXhPaXXJLqlF71RCSwAD1SINCVkpesOvZ3a+nL96cYnn/yCQO3IW7N0j2Lt1N5Zs6suSuFgHLkU2yCJD5EuyllwohsPKTCHR89atAai7RiKXulgesBFZSsqgM6D7T8+UTgldHY3LDNGPHYT67mGimrUc6TL3bzXLR7sUr7nXg3P4VupiJsQHxsNhAqNmyJouaUaTrs/ckwmzgvzJXm7coVAHOE1Cy/QcJaPO/IL69ZLhSYJnDip9u9TKamzWU01wxkdFrE/SMNCEb+8kjuGpjOslggA7yPC/cnSFxVUDf/2DGtqf2cUPT/sLzCnNzgkgdbFukcphnadW/2CelGWP5vUqlO/xwd3NSj2KxBAcyCIraUZzb1i94cPoArT2ugJYlmypUkhCOjOR+TwfjpTyMvVvEgNN+A+OYNXXTUfG/klJl9S+pFmOQZVvvCceUOtOKDfNgBojx3Okw3DYh2VmvyIJAYw6WemeUoz7xzZCBWzRjLoP4kWbodkSZ1XCzmS9DMqjlNeGY7eMDffBGGXjfmEmvGj38U/fMjF3t5zZ+XIA3v+1jW+3BfjhaT/vTxTqPZsJTUN1rze14Z0BjFQSiWnV9+Ie20Atq1VTVLu1jl/E5g4n55CR6McOQq5b8b3WnV4qXHkk7PXgvKirq6qnh5IMpcmtb88i9nafunNEWcy1d2rhmjSieIKZ0ykerL3bg0kro3sKy0ytsoCYpbyM/UsYm1s33HR6qXDFvXXTuXhZWljwY3OOdGZC0w5d+1RZTRe3usWhk+g2Q65y9e1U+jU0XUs023OUhPJc3Iu3m0WsLnXXz2gtQXTPnL5POr3UDOv6K13edypVZ0XY6azNVBJdsGD5wy+wfGse89cXsD7nJbpiYu1Gyh7vvChaj/8XEzb+4d0qquxR/ulv5pm+ZealH9THFncLJeo+iP/ciDIdVlEWEp0sHp7EMTyi3JxxKYtsgDLlb6Ny+KOExUeAtUut0JdjV8+okwVXAGffCNV9KLt6xh1UbLLuhsM+LPP7U2Yd6/jStEe9UD1VLTw0Ht+pkyudIhto/RHXuLOly9y/ZiJ74v2XOjOYoU5bKE0Iy54uubzQeBuLS7eUQFUn19clpZ0Z2Wy52sJrtucoiVEnCy4PTi1uQt3MBE60YYw9c/rfNaTPLvU3CyL1fBXYuG9k9dI+7H92C/t3Pwcg6jez+rN9RBcKm8mWHTjQtZFv5Pp6K/PzadXKLUE+2SAIm6TTS00vLIqeL2yCovL4d7oh1++hjpG8e0UQtpBMs0BByEZRGf6dztqpLryPuhJCSRCXdVz4Zd++sEnE8AvCDkTbvSMIhSCL/oIgCCWGGH5BEIQSw2i31eQd2WIuw27bml+gCoIgCI8G8fgFQRBKDDH8giAIJYYYfkEQhBJDDL8gCEKJUVSGv+/FL/jk+1d5+/XbGeO8/fptPvn+Vfpe/GIbayYIgvDVoagM/0vPLXDmXQdn3nVkjKOFv/TcwjbWbAfQcRvb0BVMHfrrQSr197aIsv4rVF64TdnWZisIwjZRdL/cvT5r5dqsNWP4tVkrlbbi+TJJ+dlBzHePEXgjc523hbF9BMb2xS7L/3QcJo6xXGi9Tk5T2WFn5ZV9JH/Fb+ONQ4lHJgqC8NAoP+jD/Cc3CP/7k6xPKk6x4XdWsLzyv6z96nEiH+/LkUMqReXxC1tL1PuIByNBEIqSovH4mxs3/7nnvXVr3PFnO47Cj2XoGtGJGqxtU0QmFM+8rP8KFW1zShTPEZZP1yl/d9zG9tp4rFPCl3sIndfyCmK6cBmreu5BZOLbRJp/oVw3XaZyqJX7x1tYT1OLsv4rVOxpJFg3rsRfamflFQdGLb+l9gTPuvzsILu0o2F1Ycrs4giR5g/UeujK7LiN7bVVwsebMGj5Ng1i7tDS+7EMfaCeAdZA8K1DrI2llheZOEaQT2L9UzE0ntQPWnua1X7LL9+0db0Mu45Nxcp95LMmQSgRisLwv/36bZ5qDHF91sK1WUvO+NdmLVyftfCT/ptcm7XQ+2a2qc4c1j3NLB/vUS5PTlPR3MjK8UMxY2rrVweEQ6tE3uohMKbEqzw2TeR8C+uq0Tde06QTP6Z+C2uv9BDNV+ppmoW3elgeU/KqGGogqLu29jvUPPwYOcLy8Tpig00sDIxt14i81cPymGpYzzriAxcA1li9jFOawQ5iuvABXO5h+Tyq4Z0mOtZCtP8Ku2LlaRxiOYvUEycpXx1l/VfYVdfOynE1/clpKi/c1uU3xa7WI8r/S8dtbK99gqkjPmgIgvDwKBqpp4wNKjah3VfYopSxkccCYwPBn2tGLYipY4rwWNyYrU+1YtyjnJG08UZL3PCcdxA7XLHDh5F2gjHjXsdaBkNffnaQyiH131nducCeZjVvK5FrDSnXWh2gjlDMkKtxdUQmvhmr4/pUK9St5u6Dkx6stBPWjPOYg8jSAoYO2PDW5JdHWqxE/WBwJs/W/JjbIHheN2icbyLILMbYQnMr97V2jjmILM1hOFBQJQRB2CRF4fF/7819NDcG+Un/TZobQ/z6xq6s8ZsbQ+ytW+OFv3XlkHrSYz42iPmY7sZSO2XUJckhAK3Kod0HVjH6HVk83zjrp3seeOEzQYpCMfZp+cxOJN8dO1XjVAyNJ9wKHwDOt7DivKKEJUlO+bB++hiRC5epHEqWa2qIJnjvVqL+OYwHgM+Sc1EHkE2UKwhC4RSF4QcSdvI0NwYZeP1zOvqejO3XP/PuY3x05jrf08k6hRj9ZB06jroeoMooyrUvHly3qg4OD5eYfn78UOx6S5Rv/VpGEtounbL+K1SctWeMlx5FWlpTZSnLSU1eUmYU67F+DmKoayCaYvQFQcjKehkYoxh2B2NriIaGZTBGIVCIDSxSJ+uO30Tvm48D8OMPa/nxh7WAMjMozNhrWIlcA+vJNHvQO1Yx6L3Uk76453/eQbhqHGu/Jmn4MfU/nLOHDXvmiNy1q1dBjM1zWePnxXkH4aYPsJzMHi2r7KNq9JklIb3sU0fEM5fYzyc9WGkkIhq+IGyKdc9uNhasGA/NYmy7Q/nX5jEevs3Gipn1/8v/68p6isbj13iqMcRywBCbAegN/bVZK82NQZ5qDBWc/8Ybh7h/djBB9lB2rewjeOgKFUODyk1Pa1zjp47Q8SNYhhRJQ0sDsP7zdngt+66ezbB++gjRWDkNhD0NuZLkQR2ht9qxvTZIpSZxqbIOCbJSK/e1xdjzTQQ7Lsd39aTNN3GnE54jsd8NrJ/uSeznAmQkQRCA+ybCl5/C/J1rmF+4AcDGgpXwvz3JxpeF6QFlX/9aT97vYk1tGQv3Ht6r2/fiF7z03AL/fWNXgqSj5+3Xb/P7T97nxx/WcObdxx5aXYTMKPLTN2X7pSDsUIrK8As7AcXLN4wl7u0XBGHnUHRSj1Cs6GQdz5GUffuCIOwcxPALeaLt3hEEYadTlLt6BEEQhIeHGH5BEIQSw7gayP+79qtbsKVcEARBeLSIxy8IglBiiOEXBEEoMcTwC4IglBj/D+fkuUwnX6LGAAAAAElFTkSuQmCC"></p><p>打开<code>react.dll.xx.js</code>看一下，内部确实包含了<code>react.production.min.js</code>和<code>react-dom.production.min.js</code>生产版本的代码。再打开<code>manifest.json</code>文件，内部包含了模块 id，DLL 的 名称，DLL 包含的所有模块。</p><p><img alt="image-20200913192529421" src="/assets/images/image-20200913192529421-5b42c6748d3429f32025543573225260.png"></p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="dllreferenceplugin">DllReferencePlugin<a class="hash-link" href="#dllreferenceplugin" title="Direct link to heading">​</a></h3><p><code>DllReferencePlugin</code>负责根据<code>DllPlugin</code> 生成的<code>manifest.json</code>将项目 chunk 和 DLL 链接在一起。</p><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="配置项-3">配置项<a class="hash-link" href="#配置项-3" title="Direct link to heading">​</a></h4><table><thead><tr><th>配置项</th><th>类型</th><th>是否必填</th><th>含义</th></tr></thead><tbody><tr><td><code>context</code></td><td><code>String</code></td><td>yes</td><td><code>manifest.json</code>文件中请求的 context；默认是 webpack 的<code>context</code>配置项，也就是<code>webpack.config.js</code>所在的当前目录</td></tr><tr><td><code>scope</code></td><td><code>String</code></td><td>no</td><td>DLL 中内容的前缀</td></tr><tr><td><code>extensions</code></td><td><code>Array</code></td><td>no</td><td>用于解析 DLL bundle 中模块的扩展名，仅在使用<code>scope</code>时使用</td></tr><tr><td><code>content</code></td><td><code>String</code></td><td>no</td><td>请求到模块 id 的映射，默认是<code>manifest.json</code>文件内部的<code>content</code></td></tr><tr><td><code>name</code></td><td><code>String</code></td><td>no</td><td>暴露出的 DLL 的函数名称，默认是<code>manifest.json</code>文件内部的<code>name</code></td></tr><tr><td><code>manifest</code></td><td><code>Object</code></td><td>yes</td><td><code>String</code></td></tr><tr><td><code>sourceType</code></td><td><code>String</code></td><td>no</td><td>DLL 是如何暴露自己模块的，见 —— <a href="https://webpack.docschina.org/configuration/output/#outputlibrarytarget" target="_blank" rel="noopener noreferrer"><code>output.libraryTarget</code></a></td></tr></tbody></table><blockquote><p>Note：需要特别注意的一点这里的<code>context</code>这个配置项是必填的，并且必须指向<code>manifest.json</code>所在的目录的绝对路径。webpack 文档中给的说明<code>context</code>的 example 比较模糊，按照<a href="https://github.com/webpack/webpack/tree/master/test/configCases/dll-plugin/2-use-dll-without-scope" target="_blank" rel="noopener noreferrer">use-dll-without-scope</a>这个例子看比较清楚一点<code>context</code>的用法。</p></blockquote><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="使用-3">使用<a class="hash-link" href="#使用-3" title="Direct link to heading">​</a></h4><p><code>DllReferencePlugin</code>使用相对简单，在项目本来的<code>webpack.config.js</code>中按照 plugin 引入即可。如果有多个抽取的 DLL，可以使用多次。</p><div class="codeBlockContainer_J+bg language-javascript theme-code-block"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  plugin</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">webpack</span><span class="token class-name punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token class-name">DllReferencePlugin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      context</span><span class="token operator">:</span><span class="token plain"> path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">resolve</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">__dirname</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;./dll&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      manifest</span><span class="token operator">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">require</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;./dll/react-manifest.json&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">webpack</span><span class="token class-name punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token class-name">DllReferencePlugin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      context</span><span class="token operator">:</span><span class="token plain"> path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">resolve</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">__dirname</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;./dll&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      manifest</span><span class="token operator">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">require</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;./dll/other-manifest.json&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">//...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>这样再执行<code>yarn build</code>打包，webpack 就会自动跳对<code>react</code>模块了。打包信息显示 webpack external（使用外部拓展）了<code>react_dll</code>。</p><p><img alt="image-20200913194138841" src="/assets/images/image-20200913194138841-9fe7d64872e258d05d65702c39b81392.png"></p><p>在<code>webpack.config.js</code>内部不使用<code>DllReferencePlugin</code>时，整个打包过程需要 5S 左右的时间，使用之后，减少了 2S。</p><p><img alt="image-20200913194517301" src="/assets/images/image-20200913194517301-7e8be4d22339a891b838647fe730ccfd.png"><img alt="image-20200913194635839" src="/assets/images/image-20200913194635839-2ef2c0a2c2f67debe0923c75250f4a31.png"></p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="复制-dll-文件">复制 DLL 文件<a class="hash-link" href="#复制-dll-文件" title="Direct link to heading">​</a></h3><p>第三方库的 DLL 文件，需要插入 HTML 中，并且复制到项目的<code>build</code>目录下，否则项目无法运行。</p><p>使用<a href="https://github.com/webpack-contrib/copy-webpack-plugin" target="_blank" rel="noopener noreferrer"><code>copy-webpack-plugin</code></a>将 DLL 复制到<code>build</code>目录，使用<a href="https://github.com/jharris4/html-webpack-tags-plugin" target="_blank" rel="noopener noreferrer"><code>html-webpack-tags-plugin</code></a>将额外的<code>&lt;script&gt;</code>标签插入到 HTML 页面中，<code>html-webpack-tags-plugin</code>需要配合 HtmlWebpackPlugin 一起使用。</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">yarn</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">add</span><span class="token plain"> copy-webpack-plugin html-webpack-tags-plugin -D</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg language-javascript theme-code-block"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  plugin</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">CopyWebpackPlugin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      patterns</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;./dll/react.dffd2b4e9672e773b9c9.dll.js&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> to</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;static/js&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      inject</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      template</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;./public/index.html&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      favicon</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;./public/favicon.ico&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">HtmlWebpackTagsPlugin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      append</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      publicPath</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;static/js&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">//dll.js文件的路径前缀</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      tags</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;react.dffd2b4e9672e773b9c9.dll.js&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><img alt="image-20200913230740962" src="/assets/images/image-20200913230740962-c5a83e19619cccf66f8b0a680661293e.png"></p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="和-splitchunksplugin-的冲突">和 SplitChunksPlugin 的冲突<a class="hash-link" href="#和-splitchunksplugin-的冲突" title="Direct link to heading">​</a></h3><p>经过我的测试，如果 webpack 配置了<code>SplitChunksPlugin</code>来抽取<code>node_modules</code>中的代码，和<code>DllReferencePlugin</code>确实是有冲突的。</p><p>因为我的测试项目很小，只引入了<code>react</code>和<code>react-dom</code>这两个第三方库，而现在我又通过<code>DllPlugin</code>把它们两个抽取了出来单独打包，所以项目就不应该存在 vendor chunk 了才对，但是无论开发环境还是生产环境，配置了如下的<code>SplitChunksPlugin</code>都会把<code>react</code>部分打包进来。</p><div class="codeBlockContainer_J+bg language-javascript theme-code-block"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  optimization</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    splitChunks</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      cacheGroups</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        vendor</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          test</span><span class="token operator">:</span><span class="token plain"> </span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex regex-delimiter">/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;vendors&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          chunks</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;all&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// 或者是</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  optimization</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    splitChunks</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      chunks</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;all&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><img alt="image-20200913232708859" src="/assets/images/image-20200913232708859-6f0079bbb6747611d01b4063994f2f2b.png"></p><p><img alt="image-20200913232837318" src="/assets/images/image-20200913232837318-222f1536f32e5b5f958c47f4b2356542.png"></p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="externals">externals<a class="hash-link" href="#externals" title="Direct link to heading">​</a></h2><p><code>externals</code>可以直接将某些模块在打包过程中剔除，这样减少 webpack 打包时候的工作量，从而加快构建速度。</p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="配置项-4">配置项<a class="hash-link" href="#配置项-4" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="正则表达式">正则表达式<a class="hash-link" href="#正则表达式" title="Direct link to heading">​</a></h4><p>可以为<code>externals</code>指定一个正则表达式，则所有匹配名称的模块在打包的时候都会被忽略</p><div class="codeBlockContainer_J+bg language-javascript theme-code-block"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  externals</span><span class="token operator">:</span><span class="token plain"> </span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">react</span><span class="token regex regex-delimiter">/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="对象">对象<a class="hash-link" href="#对象" title="Direct link to heading">​</a></h4><p>可以为<code>externals</code>指定一个对象形式，属性的键表示忽略的模块名，属性的名称表示<code>library</code>暴露的全局变量，例如使用 React 会去这样导入其内部的<code>React</code>和<code>ReactDOM</code> API</p><div class="codeBlockContainer_J+bg language-javascript theme-code-block"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token plain"> </span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;react&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">ReactDOM</span><span class="token plain"> </span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;react-dom&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>那么通过<code>externals</code>就可以像下面这样去配置，<code>react</code>和<code>&quot;react-dom&quot;</code>表示 webpack 打包要排除上面<code>import</code>中<code>from</code>的模块，为了替换这些模块，需要使用<code>React</code>和<code>ReactDOM</code>这样的全局变量。</p><div class="codeBlockContainer_J+bg language-javascript theme-code-block"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  externals</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    react</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;React&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;react-dom&#x27;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;ReactDOM&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>这样执行<code>yarn build</code>打包以后，可以看到 webpack external 了<code>React</code>和<code>ReactDOM</code>的全局变量。</p><p><img alt="image-20200914154732218" src="/assets/images/image-20200914154732218-d93c9254c825e82099b6d7fca0de1d93.png"></p><p>为了能够找到<code>React</code>和<code>ReactDOM</code>这样的全局变量，需要将 React 库放在 HTML 中通过<code>&lt;script&gt;</code>全局引入。</p><div class="codeBlockContainer_J+bg language-html theme-code-block"><div class="codeBlockContent_csEI html"><pre tabindex="0" class="prism-code language-html codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">script</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">crossorigin</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">src</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">react.production.min.js</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token script"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">script</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">script</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">crossorigin</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">src</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">react-dom.production.min.js</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token script"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">script</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>对于具有父级模块的结构，也可以传入一个数组作为属性名，其中<code>./math</code>属于父模块，表示<code>subtract</code>只使用了<code>./math</code>内部的<code>other</code>模块，所以这个结果最终被编译成<code>require(&#x27;./math&#x27;).subtract</code>。</p><div class="codeBlockContainer_J+bg language-javascript theme-code-block"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">//...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  externals</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    subtract</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;./math&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;other&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="可能并不需要-dllplugin">可能并不需要 DllPlugin<a class="hash-link" href="#可能并不需要-dllplugin" title="Direct link to heading">​</a></h3><p><code>DllPlugin</code>本身更多的用处是把第三方库抽成单独的<code>library</code>，而且还需要暴露全局变量，即通过<code>&lt;script&gt;</code>的方式全局注入，然后通过<code>DllReferencePlugin</code>引用<code>library</code>。</p><p>那为什么不直接用 CDN +<code>externals</code>的方式呢？把资源通过 CDN 引入，然后直接<code>externals</code>忽略模块打包完事了呀！</p><p>CDN 的配置可以使用很多方式，首先可以直接将 CDN 资源手动放在 HTML 模板页面，通过<code>HtmlWebpackPlugin</code>就会自动生成带有 CDN 资源的 HTML 页面。</p><p>例如在上文配置了<code>externals</code>忽略 React 的时候，在 HTML 页面添加 React 的 jsDelivr 的 CDN 链接：</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token operator">&lt;</span><span class="token plain">script crossorigin </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">src</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;https://cdn.jsdelivr.net/npm/react@16.12.0/umd/react.production.min.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token plain">/script</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">&lt;</span><span class="token plain">script crossorigin </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">src</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;https://cdn.jsdelivr.net/npm/react-dom@16.12.0/umd/react-dom.production.min.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token plain">/script</span><span class="token operator">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>也可以借助<code>HtmlWebpackPlugin</code>的<a href="https://github.com/jantimon/html-webpack-plugin#writing-your-own-templates" target="_blank" rel="noopener noreferrer">自定义模板</a>来解决，<code>HtmlWebpackPlugin</code>默认是支持 <a href="https://ejs.bootcss.com/" target="_blank" rel="noopener noreferrer">ejs 模板</a>，对传入<code>HtmlWebpackPlugin</code>的配置项可以在 HTML 中<code>&lt;%= htmlWebpackPlugin.options.xxx %&gt;</code>的形式去访问。</p><p>这里还得区分 React 开发环境和生产环境的版本，如果在开发环境使用了生产环境的 React，有一个区别是浏览器的 React devtools 插件就检测不到应用是在开发环境，因此也就没用了。</p><div class="codeBlockContainer_J+bg language-javascript theme-code-block"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  plugins</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      inject</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      template</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;./public/index.html&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      favicon</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;./public/favicon.ico&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      cdn</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        script</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          isDevelopment</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token operator">?</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;https://cdn.jsdelivr.net/npm/react@16.12.0/umd/react.development.js&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;https://cdn.jsdelivr.net/npm/react@16.12.0/umd/react.production.min.js&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          isDevelopment</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token operator">?</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;https://cdn.jsdelivr.net/npm/react-dom@16.12.0/umd/react-dom.development.js&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;https://cdn.jsdelivr.net/npm/react-dom@16.12.0/umd/react-dom.production.min.js&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>修改 HTML 页面，ejs 本身很简单，直接在 HTML 里写的每一行 JS 代码用<code>&lt;% ... %&gt;</code>包起来就行，如果是变量，用<code>&lt;%= ... %&gt;</code>包起来。</p><div class="codeBlockContainer_J+bg language-html theme-code-block"><div class="codeBlockContent_csEI html"><pre tabindex="0" class="prism-code language-html codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token doctype punctuation" style="color:rgb(248, 248, 242)">&lt;!</span><span class="token doctype doctype-tag">DOCTYPE</span><span class="token doctype"> </span><span class="token doctype name">html</span><span class="token doctype punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">html</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">lang</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">zh-hans</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">head</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">meta</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">charset</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">utf-8</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">title</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">toycra</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">title</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">head</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">body</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">div</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">root</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">div</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">&lt;!--CDN--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;% if (htmlWebpackPlugin.options.cdn) { %&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &lt;% for(let src of htmlWebpackPlugin.options.cdn.script) { %&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">script</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">crossorigin</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">anonymous</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">src</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">&lt;%=src%&gt;</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">script</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &lt;% } %&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;% } %&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">body</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">html</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>现在执行打包，React 模块就被<code>externals</code>的配置忽略掉了，其使用 CDN 方式全局注入。</p><p><img alt="image-20200914181903091" src="/assets/images/image-20200914181903091-164113815888335-15a19aa5b2eabf69984264f6bb67539d.png"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/wood3n/icodex-next/tree/master/docs/engineer/webpack优化/webpack优化（3）.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/engineer/webpack优化/webpack优化（2）"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">webpack优化（2）</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/engineer/webpack优化/webpack优化（4）"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">webpack优化（4）</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#优化模块解析规则" class="table-of-contents__link toc-highlight">优化模块解析规则</a><ul><li><a href="#ruleinclude-和-ruleexclude" class="table-of-contents__link toc-highlight">rule.include 和 rule.exclude</a></li><li><a href="#resolvemodules" class="table-of-contents__link toc-highlight">resolve.modules</a></li><li><a href="#resolvesymlinks" class="table-of-contents__link toc-highlight">resolve.symlinks</a></li><li><a href="#modulenoparse" class="table-of-contents__link toc-highlight">module.noParse</a></li></ul></li><li><a href="#利用缓存" class="table-of-contents__link toc-highlight">利用缓存</a><ul><li><a href="#优化-babel-loader" class="table-of-contents__link toc-highlight">优化 babel-loader</a></li><li><a href="#优化-eslint-loader" class="table-of-contents__link toc-highlight">优化 eslint-loader</a></li><li><a href="#cache-loader" class="table-of-contents__link toc-highlight">cache-loader</a></li></ul></li><li><a href="#多线程打包" class="table-of-contents__link toc-highlight">多线程打包</a><ul><li><a href="#thread-loader" class="table-of-contents__link toc-highlight">thread-loader</a></li></ul></li><li><a href="#dll" class="table-of-contents__link toc-highlight">DLL</a><ul><li><a href="#library" class="table-of-contents__link toc-highlight">library</a></li><li><a href="#dllplugin" class="table-of-contents__link toc-highlight">DllPlugin</a></li><li><a href="#dllreferenceplugin" class="table-of-contents__link toc-highlight">DllReferencePlugin</a></li><li><a href="#复制-dll-文件" class="table-of-contents__link toc-highlight">复制 DLL 文件</a></li><li><a href="#和-splitchunksplugin-的冲突" class="table-of-contents__link toc-highlight">和 SplitChunksPlugin 的冲突</a></li></ul></li><li><a href="#externals" class="table-of-contents__link toc-highlight">externals</a><ul><li><a href="#配置项-4" class="table-of-contents__link toc-highlight">配置项</a></li><li><a href="#可能并不需要-dllplugin" class="table-of-contents__link toc-highlight">可能并不需要 DllPlugin</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.bc1968d0.js"></script>
<script src="/assets/js/main.84a75bf0.js"></script>
</body>
</html>