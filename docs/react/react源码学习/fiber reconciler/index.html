<!doctype html>
<html class="docs-version-current" lang="zh-CN" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="icodex RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="icodex Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-153188913-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-153188913-1",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="icodex" href="/opensearch.xml">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">fiber reconciler | icodex</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://icodex.me/docs/react/react源码学习/fiber reconciler"><meta data-react-helmet="true" name="docsearch:language" content="zh-CN"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" name="keywords" content="frontend, react, javascript, css, react, vue, typescript, docusaurus, blog, personal blog, personal website"><meta data-react-helmet="true" property="og:title" content="fiber reconciler | icodex"><meta data-react-helmet="true" name="description" content="什么是 fiber"><meta data-react-helmet="true" property="og:description" content="什么是 fiber"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://icodex.me/docs/react/react源码学习/fiber reconciler"><link data-react-helmet="true" rel="alternate" href="https://icodex.me/docs/react/react源码学习/fiber reconciler" hreflang="zh-CN"><link data-react-helmet="true" rel="alternate" href="https://icodex.me/docs/react/react源码学习/fiber reconciler" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://GMKEEJO8X4-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.83facce5.css">
<link rel="preload" href="/assets/js/runtime~main.bc1968d0.js" as="script">
<link rel="preload" href="/assets/js/main.84a75bf0.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_RReh"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="icodex" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo.png" alt="icodex" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">icodex</b></a></div><div class="navbar__items navbar__items--right"><div class="searchBox_Utm0"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><a class="navbar__item navbar__link" href="/pages/project">My Project</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">Skill</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/javascript/类型/类型定义">JavaScript</a></li><li><a class="dropdown__link" href="/docs/css/CSS代码规范">CSS</a></li><li><a class="dropdown__link" href="/docs/typescript/tsconfig">TypeScript</a></li><li><a class="dropdown__link navbar__link--active" href="/docs/react/hooks/常用hooks">React</a></li><li><a class="dropdown__link" href="/docs/nodejs/awesome-nodejs">NodeJS</a></li><li><a class="dropdown__link" href="/docs/engineer/">Engineer</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">Learn</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/network/网速与带宽">Network</a></li><li><a class="dropdown__link" href="/docs/algorithm/算法分析">Algorithm</a></li></ul></div><a class="navbar__item navbar__link" href="/docs/tools/git">Tool</a><a href="https://github.com/wood3n/icodex-next" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌜</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">🌞</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0 sidebarWithHideableNavbar_VlPv"><a tabindex="-1" class="sidebarLogo_hmkv" href="/"><img src="/img/logo.png" alt="icodex" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo.png" alt="icodex" class="themedImage_TMUO themedImage--dark_uzRr"><b>icodex</b></a><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/react/hooks/hooks心智模型">hooks</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/docs/react/react源码学习/fiber reconciler">react源码学习</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/react/react源码学习/fiber reconciler">fiber reconciler</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reactdom-render">ReactDOM-render渲染过程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/react/react源码学习/stack reconciler">stack reconciler</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/react/redux/redux入门">redux</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/react/router/react router api">router</a></div></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>fiber reconciler</h1></header><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="什么是-fiber">什么是 fiber<a class="hash-link" href="#什么是-fiber" title="Direct link to heading">​</a></h2><p><code>fiber</code>翻译过来是纤维的意思，是 React 16 版本以后针对组件设计的一个对象的数据结构，一个 React 组件就对应一个<code>fiber</code>节点，其保存组件内部一些属性或者方法：</p><ul><li><p><code>type</code>：组件的类型</p></li><li><p><code>key</code>：组件更新的标记</p></li><li><p><code>child</code> ：对应当前组件渲染的子组件</p></li><li><p><code>sibling</code>：当一个组件返回多个子元素的组成的数组时，<code>sibling</code>就表示子组件的兄弟组件</p></li><li><p><code>return</code>：当前组件的父节点</p></li><li><p><code>pendingProps</code> 和<code>memoizedProps</code>：分别代表更新的<code>props</code>属性和当前<code>props</code>属性，如果更新后的这俩值相同就表示当前节点可以直接复用</p></li><li><p><code>pendingWorkPriority</code>：一个代表组件更新优先级的数字</p></li><li><p><code>output</code>：一个包含最终输出的 DOM 节点的数据结构，最终会传递给<code>renderer</code>去选择创建、更新到 UI 上去</p></li><li><p><code>alternate</code>：当前<code>fiber</code>在另一次更新时对应的<code>fiber</code></p></li></ul><p>完整的<code>fiber</code>节点属性在<a href="https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiber.new.js#L117" target="_blank" rel="noopener noreferrer">源码这里</a>。</p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="两种类型的-fiber-节点">两种类型的 fiber 节点<a class="hash-link" href="#两种类型的-fiber-节点" title="Direct link to heading">​</a></h3><p>在任何时候，一个组件的实例最多存在两种类型的<code>fiber</code>节点：</p><ul><li><code>current fiber</code>：当前已经渲染出来的<code>fiber</code>节点；</li><li><code>work-in-progress fiber</code>：正在内存中构建的<code>fiber</code>节点，也就是下一次更新可能会被渲染的</li></ul><p>两种节点之间通过上述的<code>alternate</code>属性关联，<code>current fiber</code>的<code>alternate</code>指向<code>work-in-progress fiber</code>，而<code>work-in-progress fiber</code>则指向<code>current fiber</code>。</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">currentFiber</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">alternate</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> workInProgressFiber</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">workInProgressFiber</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">alternate</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> currentFiber</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>采用两种类型<code>fiber</code>节点的原因主要是为了<strong>复用<code>fiber</code>节点的状态</strong>。</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="fiber-reconciler">fiber reconciler<a class="hash-link" href="#fiber-reconciler" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="挂载阶段">挂载阶段<a class="hash-link" href="#挂载阶段" title="Direct link to heading">​</a></h3><p>首次执行<code>ReactDOM.render(&lt;App /&gt;, document.getElementById(&#x27;root&#x27;))</code>会创建一个<code>fiberRoot</code>作为整个应用的<code>fiber</code>根节点；另外，在一个应用中<code>ReactDOM.render</code>可以在不同的代码位置多次执行，所以需要额外的<code>rootFiber</code>代表当前渲染的组件树的根节点。</p><p><code>fiberRoot</code>具有一个<code>current</code>属性指向当前渲染的组件树的根节点，也就是</p><div class="codeBlockContainer_J+bg language-js theme-code-block"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">fiberRoot</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">current</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> rootFiber</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>但是由于是首次执行的挂载阶段，所以此时<code>current = rootFiber = null</code>。所以需要先递归遍历整个组件树，不断的创建新的<code>fiber</code>节点并通过<code>fiber.child</code>、<code>fiber.sibling</code>等属性关联父子节点、兄弟节点等，最终形成一棵<code>work-in-progress fiber tree</code>。</p><p><img alt="image-20210926231050648" src="data:image/png;base64,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"></p><p>然后将<code>fiberRoot</code>的<code>current</code>属性指向该<code>work-in-progress fiber tree</code>的根节点，然后提交到<code>renderer</code>进行渲染。</p><p><img alt="image-20210926231121639" src="/assets/images/image-20210926231121639-5be52bc01705b8e0da6520309e04a844.png"></p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="更新阶段">更新阶段<a class="hash-link" href="#更新阶段" title="Direct link to heading">​</a></h3><p>在组件更新的时候会创建新的<code>work-in-progress fiber</code>，但是此时已经存在<code>current fiber</code>，它们之间通过<code>alternate</code>属性进行关联，所以它们之间会通过 diff 算法进行对比，判断是否复用之前<code>current fiber</code>的状态。</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="fiber-解决了什么问题">fiber 解决了什么问题<a class="hash-link" href="#fiber-解决了什么问题" title="Direct link to heading">​</a></h2><p><code>fiber reonciler</code>主要是为了解决<code>stack reconciler</code>的以下问题：</p><ul><li>支持返回多个元素；</li><li>避免遍历更新队列一次性操作 DOM 可能阻塞 UI 渲染的问题；</li><li>更新处理时把任务进行优先级拆分，保证 UI 及时更新；</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/wood3n/icodex-next/tree/master/docs/react/react源码学习/fiber reconciler.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/react/hooks/常用hooks"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Hook API学习</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/reactdom-render"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">ReactDOM-render渲染过程</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#什么是-fiber" class="table-of-contents__link toc-highlight">什么是 fiber</a><ul><li><a href="#两种类型的-fiber-节点" class="table-of-contents__link toc-highlight">两种类型的 fiber 节点</a></li></ul></li><li><a href="#fiber-reconciler" class="table-of-contents__link toc-highlight">fiber reconciler</a><ul><li><a href="#挂载阶段" class="table-of-contents__link toc-highlight">挂载阶段</a></li><li><a href="#更新阶段" class="table-of-contents__link toc-highlight">更新阶段</a></li></ul></li><li><a href="#fiber-解决了什么问题" class="table-of-contents__link toc-highlight">fiber 解决了什么问题</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.bc1968d0.js"></script>
<script src="/assets/js/main.84a75bf0.js"></script>
</body>
</html>